<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>For My Love</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Elegant Font -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <canvas id="heartCanvas"></canvas>

    <!-- Cinematic overlays -->
    <div class="film-grain"></div>
    <div class="soft-vignette"></div>

    <!-- Message -->
    <div id="text" class="valentine-text">
        Happy Valentine's Day,<br>My Love!
    </div>

    <div class="rose" onclick="revealMessage()" aria-label="Click to reveal" role="button">
        <div class="stem"></div>
        <div class="leaf left"></div>
        <div class="leaf right"></div>
        <div class="bud"></div>
        <div class="petal p1"></div>
        <div class="petal p2"></div>
        <div class="petal p3"></div>
        <div class="petal p4"></div>
    </div>

    <!-- Music -->
    <audio id="bgMusic" loop>
        <source src="song.mp3" type="audio/mpeg">
    </audio>

<script>
const canvas = document.getElementById('heartCanvas');
const ctx = canvas.getContext('2d');
let width, height;

function resize() {
    const dpr = window.devicePixelRatio || 1;
    canvas.width = window.innerWidth * dpr;
    canvas.height = window.innerHeight * dpr;
    canvas.style.width = window.innerWidth + "px";
    canvas.style.height = window.innerHeight + "px";
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    width = window.innerWidth;
    height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

class Heart {
    constructor(isExplosion = false) {
        this.spawn(isExplosion);
    }

    spawn(isExplosion) {
        this.size = Math.random() * 14 + 8;
        this.color = this.getPinkShade();

        if (isExplosion) {
            this.x = width / 2;
            this.y = height / 2;
            this.vx = (Math.random() - 0.5) * 12;
            this.vy = (Math.random() - 0.5) * 12;
            this.opacity = 1;
        } else {
            this.x = Math.random() * width;
            this.y = height + 30;
            this.speed = Math.random() * 1.2 + 0.4;
            this.opacity = Math.random() * 0.4 + 0.4;
            this.wobble = Math.random() * Math.PI * 2;
            this.wobbleSpeed = Math.random() * 0.03 + 0.01;
        }
    }

    getPinkShade() {
        const shades = [
            'rgba(255, 105, 180,',
            'rgba(255, 20, 147,',
            'rgba(255, 182, 193,'
        ];
        return shades[Math.floor(Math.random() * shades.length)];
    }

    update() {
        if (this.vx !== undefined) {
            this.x += this.vx;
            this.y += this.vy;
            this.vy += 0.2;
            this.opacity -= 0.02;
            if (this.opacity <= 0) this.spawn(false);
        } else {
            this.y -= this.speed;
            this.wobble += this.wobbleSpeed;
            this.x += Math.sin(this.wobble) * 0.6;
            if (this.y < -30) this.spawn(false);
        }
    }

    draw() {
        ctx.save();
        ctx.globalAlpha = this.opacity;
        ctx.fillStyle = this.color + this.opacity + ')';
        ctx.shadowBlur = 12;
        ctx.shadowColor = "#ff69b4";

        const x = this.x;
        const y = this.y;
        const s = this.size;

        ctx.beginPath();
        ctx.moveTo(x, y + s / 4);
        ctx.bezierCurveTo(x, y, x - s / 2, y, x - s / 2, y + s / 4);
        ctx.bezierCurveTo(x - s / 2, y + s / 2, x, y + s * 0.75, x, y + s);
        ctx.bezierCurveTo(x, y + s * 0.75, x + s / 2, y + s / 2, x + s / 2, y + s / 4);
        ctx.bezierCurveTo(x + s / 2, y, x, y, x, y + s / 4);
        ctx.fill();
        ctx.restore();
    }
}

const hearts = [];
for (let i = 0; i < 40; i++) hearts.push(new Heart());

function animate() {
    ctx.fillStyle = 'rgba(0,0,0,0.10)';
    ctx.fillRect(0, 0, width, height);
    hearts.forEach(h => { h.update(); h.draw(); });
    requestAnimationFrame(animate);
}
animate();

let revealed = false;

function revealMessage() {
    if (revealed) return;
    revealed = true;

    document.getElementById('text').classList.add('show');

    const roseBtn = document.querySelector('.rose');
    roseBtn.classList.add('plucked');
    roseBtn.style.opacity = "0";
    setTimeout(() => roseBtn.style.display = "none", 750);

    const music = document.getElementById('bgMusic');
    music.volume = 0.5;
    music.play().catch(() => {
        document.body.addEventListener('click', () => music.play(), { once: true });
    });

    for (let i = 0; i < 45; i++) hearts.push(new Heart(true));
}
</script>

</body>
</html>